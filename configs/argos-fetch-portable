#!/bin/bash

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üê∫ ARGOS FETCH - Sistema de bienvenida visual para terminal
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# --- CONFIGURACI√ìN ---
# Rutas donde el instalador (`terminal-setup.sh`) debe dejar la imagen.
ARGOS_IMAGE_PATH="$HOME/.local/share/argos/argos-image.png"
ARGOS_IMAGE_FALLBACK="$HOME/.config/argos/argos-image.png"

# --- FUNCIONES ---

# Muestra una imagen usando imgcat nativo de iTerm2
function display_iterm2_image {
    local image_file="$1"

    # Verificar que el archivo existe y es legible
    if [[ ! -f "$image_file" ]]; then
        echo "‚ö†Ô∏è  Archivo de imagen no encontrado: $image_file"
        return 1
    fi

    if [[ ! -r "$image_file" ]]; then
        echo "‚ö†Ô∏è  Sin permisos de lectura para: $image_file"
        return 1
    fi

    # Usar imgcat si est√° disponible con tama√±o controlado
    if command -v imgcat &> /dev/null; then
        # Redimensionar la imagen para que sea m√°s peque√±a y r√°pida
        imgcat --width 20 --height 10 "$image_file"
        return 0
    fi

    # Si no hay imgcat, mostrar mensaje y continuar sin imagen
    echo "‚ö†Ô∏è  imgcat no encontrado en iTerm2"
    return 1
}

# Muestra una imagen usando chafa para terminales est√°ndar
function display_chafa_image {
    local image_file="$1"
    if ! command -v chafa &> /dev/null; then
        echo "‚ö†Ô∏è chafa no encontrado. Instalar con: sudo apt install chafa / brew install chafa"
        return 1
    fi
    chafa --symbols=block --size="25x12" "$image_file"
}

# --- SCRIPT PRINCIPAL ---

# Silenciar mensaje de Powerlevel10k
export POWERLEVEL9K_INSTANT_PROMPT=quiet

# Funci√≥n de diagn√≥stico
function debug_info {
    echo "=== DIAGN√ìSTICO ==="
    echo "Terminal: $TERM_PROGRAM"
    echo "Imagen principal: $ARGOS_IMAGE_PATH"
    echo "Imagen fallback: $ARGOS_IMAGE_FALLBACK"
    echo "Imagen encontrada: $ARGOS_IMAGE"
    echo "Permisos de imagen: $(ls -la "$ARGOS_IMAGE" 2>/dev/null || echo 'No disponible')"
    echo "=================="
}

# Buscar la imagen
ARGOS_IMAGE=""
if [[ -f "$ARGOS_IMAGE_PATH" ]]; then
    ARGOS_IMAGE="$ARGOS_IMAGE_PATH"
elif [[ -f "$ARGOS_IMAGE_FALLBACK" ]]; then
    ARGOS_IMAGE="$ARGOS_IMAGE_FALLBACK"
else
    echo "‚ö†Ô∏è  Imagen ARGOS no encontrada"
    exit 1
fi

# Limpiar pantalla
clear

# Obtener informaci√≥n del sistema
USERNAME=$(whoami)

# Generar el bloque de texto compacto solo con ARGOS
TEXT_INFO=$(printf "
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üê∫ W O L F   S Y S T E M üê∫

üë§ %s
" "$USERNAME")

# Ajustar el formato para mostrar imagen y texto lado a lado
if [[ "$TERM_PROGRAM" == "iTerm.app" ]] && [[ -n "$ARGOS_IMAGE" ]]; then
    if command -v imgcat &> /dev/null; then
        TEMP_IMAGE_OUTPUT="/tmp/argos_img_$$"
        TEMP_TEXT_OUTPUT="/tmp/argos_txt_$$"

        # Generar imagen en archivo temporal
        imgcat --width 20 --height 10 "$ARGOS_IMAGE" > "$TEMP_IMAGE_OUTPUT"

        # Guardar texto en archivo temporal
        echo "$TEXT_INFO" > "$TEMP_TEXT_OUTPUT"

        # Mostrar lado a lado con paste
        paste -d'\t' "$TEMP_IMAGE_OUTPUT" "$TEMP_TEXT_OUTPUT"

        # Limpiar archivos temporales
        rm -f "$TEMP_IMAGE_OUTPUT" "$TEMP_TEXT_OUTPUT"
    else
        echo "‚ö†Ô∏è imgcat no encontrado"
        echo "$TEXT_INFO"
    fi
elif [[ -n "$ARGOS_IMAGE" ]]; then
    paste -d'  ' <(display_chafa_image "$ARGOS_IMAGE") <(echo "$TEXT_INFO")
else
    echo "‚ö†Ô∏è  Imagen ARGOS no encontrada en las rutas de instalaci√≥n."
    echo "$TEXT_INFO"
fi
